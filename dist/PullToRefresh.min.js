/*!
 * mb-pull-to-refresh v1.0.6
 * (c) 2017-2018 penyuying
 * Released under the MIT License.
 */
!function(o,l){"object"==typeof exports&&"undefined"!=typeof module?l(exports):"function"==typeof define&&define.amd?define(["exports"],l):l(o.PullToRefresh={})}(this,function(o){"use strict";function l(o,l,e){var t=this;if(t.el=t._getEl(o),t.el&&e){t.__IScroll=e,t._prefixes=["Webkit","Moz","O","Ms","Khtml"];var n=t._options=t._extend({sleep:500,pullDownHeight:54,pullUpDistance:-10,pullDownTextEl:".hook_text",isPullDown:!1,isPullUp:!0,pullUpAutoInit:!1,pullDownAutoInit:!1,iScroll:{click:!0},pullUpCallback:function(){},scrollUpCallback:function(o){},scrollDownCallback:function(o){}},l);t._iScrollInit(),n.pullDownAutoInit&&t.pullDownInit(),n.pullUpAutoInit&&t.pullUpInit(),t._bind()}}l.prototype={_extend:function(o,l){if(o||l)for(var e in l)o[e]=l[e];return o},_formatRegText:function(o){return o?o.replace(/[-[\]{}()*+?.^$|/]/g,"\\$&"):o},_addClassName:function(o,l){if(!o||!l)return o;var e=new RegExp("\\s*"+this._formatRegText(l)+"(\\s*|$)","g"),t=o.className.replace(e,function(o){return" "});return o.className=t+" "+l,o},_removeClassName:function(o,l){if(!o||!l)return o;var e=new RegExp("\\s*"+this._formatRegText(l)+"(\\s*|$)","g");return o.className=o.className.replace(e,""),o},_formatStyle:function(o){var l,e,t=this,n=t._prefixes,i="",s=document.createElement("div");if(t._memory=t._memory||{},!o)return i+o;if(!t._memory[o]){for(l=0,e=n.length;l<e;l++){var r="-"+n[l].toLowerCase()+"-";if(void 0!==s.style[r+o]){i=r,t._prefixes=[],t._prefixes.push(n[l]);break}}i||void 0===s.style[o]||(i=""),void 0!==s.style[i+o]?t._memory[o]=i+o:t._memory[o]=""}return t._memory[o]},_iScrollInit:function(){var o=this,l=this.el,e=o._options,t=o._extend({bounce:!1,scrollbar:!0,scrollbars:!0,probeType:3,freeScroll:!1},e.iScroll);t.scrollbar=t.scrollbars,o.myIScroll=new o.__IScroll(l,t),o.pullDownInit();var n,i=l.querySelectorAll("img");if(i&&!t.imgLoad)for(var s=0;s<i.length;s++){i[s].addEventListener("load",function(){n&&clearTimeout(n),n=setTimeout(function(){o._downLock||o.myIScroll.refresh()},20)})}},_getEl:function(o,l){return l=l||document,"string"==typeof o?l.querySelector(o):o},_createNode:function(o){var l,e=document.createDocumentFragment(),t=document.createElement("div");e.appendChild(t),t.innerHTML=o,l=t.childNodes||[];for(var n=0;n<l.length;n++)e.appendChild(l[n]);return e.removeChild(t),e},_setNodeHeight:function(o,l,e){var t=this,n=t._formatStyle("transition-duration");o&&(o.style[n]=e+"ms",o.style.height=l+"px"),t._domDown==o&&o&&(t._domDownDelTimeout&&clearTimeout(t._domDownDelTimeout),l<=0&&(t._domDownDelTimeout=setTimeout(function(){o.parentNode&&o.parentNode.removeChild(o),t._domDown=void 0,t.myIScroll.refresh()},e)))},pullUpInit:function(){var o=this,l=o._options,e=o.myIScroll;l.isPullUp&&(o.resetPullUp(),e.on("slideUp",function(l){o._slideUp(l)}))},resetPullUp:function(){var o=this;o._options.isPullUp&&(o.clearPullUp(),o._domUp=o._domUp||o._createUpNode(),setTimeout(function(){o.myIScroll.refresh()},100))},clearPullUp:function(){var o=this;o._domUp&&o._domUp.parentNode&&o._domUp.parentNode.removeChild(o._domUp),o._domUp=void 0,o._upLock=!1,o._pullUpFinish=!1},pullUpFinish:function(){var o=this,l=o._options,e=o.myIScroll;if(l.isPullUp&&(o._upLock=!0,o._pullUpFinish=!0,o._domUp&&o._domUp.parentNode?o._domUp=o._domUp:o._domUp=o._createUpNode(),o._domUp)){var t=o._getEl(".kid_text",o._domUp),n=o._getEl(".kid_icon",o._domUp);t.innerHTML="\u6ca1\u6709\u66f4\u591a\u6570\u636e\u4e86",o._removeClassName(t,"kid_loading"),n.style.display="block",e.refresh()}},startUpLoad:function(o){this._domUp=this._domUp||this._createUpNode(),this._startUpLoad(!o)},_startUpLoad:function(o){var l=this,e=l._options;if(e.isPullUp&&l._domUp&&!l._upLock){l.resetPullDown();var t=l._getEl(".kid_text",l._domUp);t.innerHTML="\u6b63\u5728\u52a0\u8f7d...",l._addClassName(t,"kid_loading"),l.myIScroll.refresh(),o||(l._upLock=!0,l._touchEnd&&e.pullUpCallback instanceof Function&&e.pullUpCallback())}},_slideUp:function(o){var l=this._options.pullUpDistance;this._domUp&&o>l&&this._startUpLoad()},_createUpNode:function(){var o,l,e=this.el.childNodes;if(e&&e.length>0)for(var t=0;t<e.length;t++)if(1==e[t].nodeType){l=e[t];break}var n=this._createNode('<div class="kids_pullUp"><div class="kid_pullUp-msg-wrap"><div class="kid_pullUp-msg"><span class="kid_icon">&#xe640;</span><span class="kid_text">\u4e0a\u62c9\u663e\u793a\u66f4\u591a</span></div></div></div>');return o=n.querySelector(".kids_pullUp"),l.appendChild(n),o},_slideDown:function(o){var l=this,e=l._options,t=e.pullDownHeight;if(e.isPullDown&&e.pullDownAutoInit&&(l._domDown=l._domDown||l._createDownNode(),l._stopFinish(),l._domDown)){var n=l._getEl(e.pullDownTextEl,l._domDown),i=l._getEl(".kid_pullDown-msg-text",n);o>=t/2-6&&l._touchEnd&&!l._downLock?(l._setNodeHeight(l._domDown,t,100),l._downLock=!0,i.innerHTML="\u6b63\u5728\u5237\u65b0",l.pullDownfinishAuto()):l._downLock?l.pullDownfinishAuto():(l._touchEnd=!1,i&&(i.innerHTML=o>t/2-2?"\u91ca\u653e\u5237\u65b0":"\u4e0b\u62c9\u5237\u65b0"),l._setNodeHeight(l._domDown,o,0))}},_createDownNode:function(){var o,l,e=this.el.childNodes;if(e&&e.length>0)for(var t=0;t<e.length;t++)if(1==e[t].nodeType){l=e[t];break}var n=this._createNode('<div class="kids_pullDown"><div class="kid_pullDown-msg-wrap"><ul class="kid_pullDown-msg-list"><li class="kid_pullDown-msg-item"><span class="kid_pullDown-msg-text kid_pullDown-msg-left">\u6b63\u54c1\u4fdd\u8bc1</span></li><li class="kid_pullDown-msg-item"><span class="kid_pullDown-msg-text kid_pullDown-msg-right">7\u5929\u653e\u5fc3\u9000</span></li><li class="kid_pullDown-msg-item"><span class="kid_pullDown-msg-text kid_pullDown-msg-left">\u7ae5\u5e74\u7cbe\u9009</span></li><li class="kid_pullDown-msg-item kid_pullDown-msg-active hook_text"><span class="kid_pullDown-msg-text kid_pullDown-msg-right">\u4e0b\u62c9\u5237\u65b0</span></li></ul></div></div>');return o=n.querySelector(".kids_pullDown"),l.insertBefore(n,l.firstChild),o},_stopFinish:function(){this._pullDownOut&&clearTimeout(this._pullDownOut)},pullDownInit:function(){var o=this,l=o._options,e=o.myIScroll;l.isPullDown&&l.pullDownAutoInit&&(o.resetPullDown(),e.on("slideDown",function(l){o._slideDown(l)}))},resetPullDown:function(){var o=this,l=o._options;l.isPullDown&&l.pullDownAutoInit&&(o._stopFinish(),o._domDown&&o._domDown.parentNode&&(o._domDown.parentNode.removeChild(o._domDown),o._domDown=void 0))},pullDownfinishAuto:function(){var o=this,l=o._options.sleep||0;o._downLock&&(o._pullDownOut&&clearTimeout(o._pullDownOut),o._pullDownOut=setTimeout(function(){o.pullDownfinish(300)},l))},pullDownfinish:function(o){var l=this;l._setNodeHeight(l._domDown,0,o),l._downLock=!1,setTimeout(function(){l._setNodeHeight(l._domDown,0,0)},o+1)},_bind:function(){var o=this,l=o._options,e=this.myIScroll,t=0,n=!1;function i(){o._touchEnd||!o._upLock||o._pullUpFinish||l.pullUpCallback instanceof Function&&l.pullUpCallback(),o._touchEnd=!0,n=!0,o._slideDown(e.y)}e.on("scrollStart",function(){o.myIScroll.refresh(),o._downLock||o._upLock||(o._touchEnd=!1),t=e.y,n=!1}),e.on("scroll",function(){this.y>1&&(this._execEvent?this._execEvent("slideDown",this.y):this.trigger("slideDown",this.y));var o=l.pullUpDistance;this.maxScrollY-this.y>1+Math.min(o,0)&&(this._execEvent?this._execEvent("slideUp",this.maxScrollY-this.y):this.trigger("slideUp",this.maxScrollY-this.y)),n||(t-this.y>5?l.scrollUpCallback&&l.scrollUpCallback instanceof Function&&l.scrollUpCallback(t-this.y):t-this.y<-5&&l.scrollDownCallback&&l.scrollDownCallback instanceof Function&&l.scrollDownCallback(t-this.y))}),e.on("scrollEnd",function(){o._downLock||o._setNodeHeight(o._domDown,0),l.iScroll&&l.iScroll.mouseWheel&&e.firstWheelOpreation&&i()}),o.el.addEventListener("touchend",function(){i()}),o.el.addEventListener("mouseup",function(){i()}),document.addEventListener("touchend",function(){i()})}},o.PullToRefresh=l,Object.defineProperty(o,"__esModule",{value:!0})});